$rules = {
    '..###' => '.',
    '.##.#' => '#',
    '#..#.' => '.',
    '#.#.#' => '#',
    '###..' => '#',
    '.#..#' => '.',
    '##..#' => '#',
    '.###.' => '#',
    '..#..' => '.',
    '.....' => '.',
    '#####' => '.',
    '.#...' => '#',
    '...#.' => '#',
    '#...#' => '#',
    '####.' => '.',
    '.####' => '.',
    '##.##' => '#',
    '...##' => '.',
    '..##.' => '.',
    '#.##.' => '.',
    '#....' => '.',
    '.#.#.' => '.',
    '..#.#' => '#',
    '#.#..' => '#',
    '##...' => '#',
    '##.#.' => '.',
    '#..##' => '.',
    '.##..' => '.',
    '#.###' => '.',
    '....#' => '.',
    '.#.##' => '#',
    '###.#' => '#'
}

$pots = ("."*30) +  "..#..###...#####.#.#...####.#..####..###.##.#.#.##.#....#....#.####...#....###.###..##.#....#######" + ("."*30)
$first_index = $pots.index('#')

value = 0
diff = 0
(1..1000).each do |gen|
    gen_pots = ".."

    $pots.split(//).each_cons(5) do |five|
        gen_pots << $rules[five.join]
    end

    $pots = gen_pots + ("...")

    new_value = (0 ... $pots.length).find_all { |i| $pots[i] == '#' }.map {|v| v - $first_index+2}.reduce(0,:+)
    diff = new_value - value
    value = new_value
    puts "(#{gen}) value = #{value} -- diff = #{diff}"
end
puts ((50000000000 - 1000) * diff) + value